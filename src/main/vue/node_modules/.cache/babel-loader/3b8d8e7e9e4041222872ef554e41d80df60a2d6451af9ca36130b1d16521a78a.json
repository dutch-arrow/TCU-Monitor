{"ast":null,"code":"import { toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, vShow as _vShow, createElementVNode as _createElementVNode, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"graph-label\"\n}, \"Temperature\", -1);\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_BAlert = _resolveComponent(\"BAlert\");\n  const _component_BOverlay = _resolveComponent(\"BOverlay\");\n  const _component_BFormSelect = _resolveComponent(\"BFormSelect\");\n  const _component_BFormGroup = _resolveComponent(\"BFormGroup\");\n  const _component_BCard = _resolveComponent(\"BCard\");\n  const _component_BCol = _resolveComponent(\"BCol\");\n  const _component_Line = _resolveComponent(\"Line\");\n  const _component_BRow = _resolveComponent(\"BRow\");\n  const _component_BContainer = _resolveComponent(\"BContainer\");\n  return _withDirectives((_openBlock(), _createBlock(_component_BCard, {\n    title: \"Home Page\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_BAlert, {\n      \"model-value\": $data.retrieveResult !== '',\n      variant: $data.errmsg,\n      show: \"\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(_toDisplayString($data.retrieveResult), 1)]),\n      _: 1\n    }, 8, [\"model-value\", \"variant\"]), _createVNode(_component_BOverlay, {\n      show: $data.loading,\n      variant: \"light\",\n      opacity: \"0.6\",\n      rounded: \"sm\"\n    }, null, 8, [\"show\"]), _createVNode(_component_BCard, {\n      notitle: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_BFormGroup, {\n        \"label-cols-sm\": \"5\",\n        \"label-align-sm\": \"end\",\n        label: \"Kies de TCU:\",\n        \"label-for\": \"input-1\",\n        \"content-cols-sm\": \"2\",\n        class: \"text-size\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_BFormSelect, {\n          id: \"input-1\",\n          modelValue: $data.tcu,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.tcu = $event),\n          options: $data.tcus,\n          class: \"text-size\"\n        }, null, 8, [\"modelValue\", \"options\"])]),\n        _: 1\n      }), _withDirectives(_createElementVNode(\"div\", null, [_createVNode(_component_BFormGroup, {\n        \"label-cols-sm\": \"5\",\n        \"label-align-sm\": \"end\",\n        label: \"Kies een dag:\",\n        \"label-for\": \"input-2\",\n        \"content-cols-sm\": \"2\",\n        class: \"text-size\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_BFormSelect, {\n          id: \"input-2\",\n          modelValue: $data.day,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.day = $event),\n          options: $data.fileNames,\n          class: \"text-size\"\n        }, null, 8, [\"modelValue\", \"options\"])]),\n        _: 1\n      })], 512), [[_vShow, $data.showDay]])]),\n      _: 1\n    }), _withDirectives(_createVNode(_component_BContainer, {\n      fluid: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_BRow, null, {\n        default: _withCtx(() => [_createVNode(_component_BCol, {\n          class: \"col-xxl-1\",\n          style: {\n            \"display\": \"flex\"\n          }\n        }, {\n          default: _withCtx(() => [_hoisted_1]),\n          _: 1\n        }), _createVNode(_component_BCol, {\n          class: \"col-xxl-11\"\n        }, {\n          default: _withCtx(() => [$data.loaded ? (_openBlock(), _createBlock(_component_Line, {\n            key: 0,\n            options: $data.chartOptions,\n            data: $data.tempData,\n            style: _normalizeStyle($options.chartHeight)\n          }, null, 8, [\"options\", \"data\", \"style\"])) : _createCommentVNode(\"\", true)]),\n          _: 1\n        })]),\n        _: 1\n      })]),\n      _: 1\n    }, 512), [[_vShow, $data.showGraph]])]),\n    _: 1\n  }, 512)), [[_vShow, $props.showPage]]);\n}","map":{"version":3,"mappings":";gCAiBYA,oBAA0C;EAArCC,KAAK,EAAC;AAAa,GAAC,aAAW;;;;;;;;;;;wCAhB5CC,aAuBQC;IAvBDC,KAAK,EAAC;EAAW;sBACtB,MAAiG,CAAjGC,aAAiGC;MAAxF,aAAW,EAAEC,oBAAc;MAAUC,OAAO,EAAED,YAAM;MAAEE,IAAI,EAAJ;;wBAAK,MAAoB,mCAAjBF,oBAAc;;uCACrFF,aAAgFK;MAArED,IAAI,EAAEF,aAAO;MAAEC,OAAO,EAAC,OAAO;MAACG,OAAO,EAAC,KAAK;MAACC,OAAO,EAAC;2BAChEP,aASQF;MATDU,OAAO,EAAP;IAAO;wBACZ,MAEa,CAFbR,aAEaS;QAFD,eAAa,EAAC,GAAG;QAAC,gBAAc,EAAC,KAAK;QAACC,KAAK,EAAC,cAAc;QAAC,WAAS,EAAC,SAAS;QAAC,iBAAe,EAAC,GAAG;QAACd,KAAK,EAAC;;0BACpH,MAAwF,CAAxFI,aAAwFW;UAA3EC,EAAE,EAAC,SAAS;sBAAUV,SAAG;qEAAHA,SAAG;UAAGW,OAAO,EAAEX,UAAI;UAAEN,KAAK,EAAC;;;0BAEhED,oBAIM,cAHJK,aAEaS;QAFD,eAAa,EAAC,GAAG;QAAC,gBAAc,EAAC,KAAK;QAACC,KAAK,EAAC,eAAe;QAAC,WAAS,EAAC,SAAS;QAAC,iBAAe,EAAC,GAAG;QAACd,KAAK,EAAC;;0BACrH,MAA6F,CAA7FI,aAA6FW;UAAhFC,EAAE,EAAC,SAAS;sBAAUV,SAAG;qEAAHA,SAAG;UAAGW,OAAO,EAAEX,eAAS;UAAEN,KAAK,EAAC;;;2BAF1DM,aAAO;;wBAMtBF,aASac;MATDC,KAAK,EAAL;IAAK;wBACf,MAOO,CAPPf,aAOOgB;0BANL,MAEO,CAFPhB,aAEOiB;UAFDrB,KAAK,EAAC,WAAW;UAACsB,KAAqB,EAArB;YAAA;UAAA;;4BACtB,MAA0C,CAA1CC,UAA0C;;YAE7CnB,aAEQiB;UAFFrB,KAAK,EAAC;QAAY;4BACrB,MAAyF,CAA7EM,YAAM,kBAAlBL,aAAyFuB;;YAApEP,OAAO,EAAEX,kBAAY;YAAGmB,IAAI,EAAEnB,cAAQ;YAAGgB,KAAK,kBAAEI,oBAAW;;;;;;;uBAN5DpB,eAAS;;sBAbJqB,eAAQ","names":["_createElementVNode","class","_createBlock","_component_BCard","title","_createVNode","_component_BAlert","$data","variant","show","_component_BOverlay","opacity","rounded","notitle","_component_BFormGroup","label","_component_BFormSelect","id","options","_component_BContainer","fluid","_component_BRow","_component_BCol","style","_hoisted_1","_component_Line","data","$options","$props"],"sourceRoot":"","sources":["/homes/tom/Workspaces/java/tcu-monitor/src/main/vue/src/components/Home.vue"],"sourcesContent":["<template>\n    <BCard title=\"Home Page\" v-show=\"showPage\">\n      <BAlert :model-value=\"retrieveResult !== ''\" :variant=\"errmsg\" show>{{ retrieveResult }}</BAlert>\n      <BOverlay :show=\"loading\" variant=\"light\" opacity=\"0.6\" rounded=\"sm\"></BOverlay>\n      <BCard notitle>\n        <BFormGroup label-cols-sm=\"5\" label-align-sm=\"end\" label=\"Kies de TCU:\" label-for=\"input-1\" content-cols-sm=\"2\" class=\"text-size\">\n          <BFormSelect id=\"input-1\" v-model=\"tcu\" :options=\"tcus\" class=\"text-size\"></BFormSelect>\n        </BFormGroup>\n        <div v-show=\"showDay\">\n          <BFormGroup label-cols-sm=\"5\" label-align-sm=\"end\" label=\"Kies een dag:\" label-for=\"input-2\" content-cols-sm=\"2\" class=\"text-size\">\n            <BFormSelect id=\"input-2\" v-model=\"day\" :options=\"fileNames\" class=\"text-size\"></BFormSelect>\n          </BFormGroup>\n        </div>\n      </BCard>\n      <BContainer fluid v-show=\"showGraph\">\n        <BRow>\n          <BCol class=\"col-xxl-1\" style=\"display:flex;\">\n            <div class=\"graph-label\">Temperature</div>\n          </BCol>\n         <BCol class=\"col-xxl-11\">\n            <Line v-if=\"loaded\" :options=\"chartOptions\" :data=\"tempData\" :style=\"chartHeight\"></Line>\n          </BCol>\n        </BRow>\n      </BContainer>\n    </BCard>\n</template>\n\n<style>\n.graph-label {\n  font-size: 14px;\n  align-self: center;\n }\n</style>\n<script>\nimport 'chartjs-adapter-moment'\n\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n  TimeScale\n} from 'chart.js'\n\nimport { Line } from 'vue-chartjs'\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n  TimeScale\n)\n\nexport default {\n  components: {\n    Line\n  },\n  name: 'HomePage',\n  props: ['showPage'],\n  data() {\n    return {\n      loading: false,\n      errmsg: '',\n      retrieveResult: '',\n      showDay: false,\n      showGraph: false,\n      config:{tcu:[]},\n      tcus:[{value:{name:'',ipaddress:''},text:''}],\n      tcu:{name:'',ipaddress:''},\n      devices:[],\n      search: '',\n      fileNames:[],\n      day: '',\n      loaded: false,\n      tempData : {labels:[],datasets:[{label:'',borderColor:'#f87979',data:[]}]},\n      stateData : {labels:[],datasets:[{label:'',borderColor:'#f87979',data:[]}]},\n      chartOptions: {responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}},\n        scales: {\n          y: {\n            ticks: {callback: function () {return '';},},\n            grid: {display: false,},\n            min: 0,\n            max: 35,\n          },\n          x: {\n            type: 'time',\n            time: {\n              unit: 'hour',\n              displayFormats: {\n                  hour: 'HH:mm'\n              },\n              tooltipFormat: 'HH:mm',\n              ticks: {\n                source: 'auto',\n              },\n            },\n          },\n        },\n      }\n    }\n  },\n  computed: {\n    chartHeight () {return {height:`${1000}px`,position: 'relative'}}\n  },\n  methods: {\n    getTcus() {\n      console.log(\"TCUs:\", this.config.tcu);\n      this.tcus = [];\n      for (var t of this.config.tcu) {\n        this.tcus.push({value:{name:t.name,ipaddress:t.ipaddress},text:t.name});\n      }\n      console.log(\"List of TCUs:\", this.tcus);\n    },\n    getProperties() {\n      console.log(\"getProperties()\");\n      this.loading = true;\n      this.axios.post(\"/api/command\", {\n        command: \"getProperties\",\n        data: {ipaddress:this.tcu.ipaddress}\n      })\n      .then(response => {\n        var f = response.data;\n        if (f.error !== undefined) {\n          this.errmsg = \"danger\";\n          this.retrieveResult = f.error;\n        } else {\n          this.devices = [];\n          for (var dev of f.devices) {\n            this.devices.push(dev.device);\n          }\n        }\n        console.log(\"Devices:\", this.devices);\n        this.loading = false;\n      })\n      .catch(error => {\n        this.retrieveResult = error.message;\n        this.errmsg = \"danger\";\n        this.loading = false;\n      });\n    },\n    getHistDataFiles() {\n      console.log(\"getHistDataFiles()\");\n      this.loading = true;\n      this.axios.post(\"/api/command\", {\n        command: \"getHistDataFiles\",\n        data: {ipaddress:this.tcu.ipaddress}\n      })\n      .then(response => {\n        var f = response.data;\n        if (f.error !== undefined) {\n          this.errmsg = \"danger\";\n          this.retrieveResult = f.error;\n        } else {\n          this.fileNames = [];\n          for (var nm of f.files) {\n            this.fileNames.push(String(nm).replace(\"temp_\",\"\"));\n          }\n        }\n        this.loading = false;\n      })\n      .catch(error => {\n        this.retrieveResult = error.message;\n        this.errmsg = \"danger\";\n        this.loading = false;\n      });\n    },\n    getTempDataFile(day) {\n      console.log(\"getTempDataFile(\" +  day + \")\");\n      this.loaded = false;\n      this.loading = true;\n      this.axios.post(\"/api/command\", {\n        command: \"getTempDataFile\",\n        data: {ipaddress:this.tcu.ipaddress, file:'temp_' + day}\n      })\n      .then(response => {\n        var f = response.data;\n        if (f.error !== undefined) {\n          this.errmsg = \"danger\";\n          this.retrieveResult = f.error;\n        } else {\n          this.errmsg = \"success\";\n          this.retrieveResult = \"\";\n          this.cvtTempData(f.content);\n        }\n        this.loading = false;\n      })\n      .catch(error => {\n        this.retrieveResult = error.message;\n        this.errmsg = \"danger\";\n        this.loading = false;\n      });\n    },\n    cvtTempData(raw) {\n/*\n2023-07-05 14:00:00 start\n2023-07-05 14:00:02 r=0 t=0\n2023-07-06 13:59:03 r=0 t=0\n...\n2023-07-06 14:00:03 r=0 t=0\n2023-07-06 14:00:02 stop\n*/\n      this.tempData.datasets[0].data = [];\n      var lines = String(raw).split(\"\\n\");\n      for (var l of lines) {\n        var parts = String(l).split(\" \");\n        if (parts.length > 3) {\n          var temp =  Number(String(parts[3]).split(\"=\")[1]); // terrarium temperature\n          if (temp === 0) temp=26.0;\n          temp = temp * 2.0 / 35;\n          var time = Date.parse(parts[0] + \"T\" + parts[1]);\n          this.tempData.datasets[0].data.push({x:time,y:temp});\n        }\n      }\n      console.log(this.tempData);\n      this.loaded = true;\n    },\n    getStateDataFile(day) {\n      console.log(\"getStateDataFile(\" +  day + \")\");\n      this.loading = true;\n      this.axios.post(\"/api/command\", {\n        command: \"getStateDataFile\",\n        data: {ipaddress:this.tcu.ipaddress, file:'state_' + day}\n      })\n      .then(response => {\n        var f = response.data;\n        if (f.error !== undefined) {\n          this.errmsg = \"danger\";\n          this.retrieveResult = f.error;\n        } else {\n          this.errmsg = \"success\";\n          this.retrieveResult = \"\";\n          this.cvtStateData(f.content);\n        }\n        this.loading = false;\n      })\n      .catch(error => {\n        this.retrieveResult = error.message;\n        this.errmsg = \"danger\";\n        this.loading = false;\n      });\n    },\n    cvtStateData(raw) {\n/*\n2023-07-04 17:00:00 start\n2023-07-04 17:00:00 light1 1\n2023-07-04 17:00:00 light2 1\n2023-07-04 17:00:00 light3 1\n2023-07-04 17:00:00 light4 1\n2023-07-04 17:00:00 uvlight 1\n2023-07-04 17:00:00 light6 0\n2023-07-04 17:00:00 pump 0\n2023-07-04 17:00:00 sprayer 0\n2023-07-04 17:00:00 mist 0\n2023-07-04 17:00:00 fan_in 1\n2023-07-04 17:00:00 fan_out 0\n2023-07-04 17:00:00 spare 0\n2023-07-04 20:00:02 pump 1 -1\n2023-07-04 20:05:02 fan_out 1 -1\n2023-07-04 20:15:02 pump 0\n2023-07-04 20:15:02 fan_in 0\n2023-07-04 20:15:02 fan_out 0\n2023-07-04 20:15:02 fan_in 1 -2\n2023-07-05 10:05:02 sprayer 1 10:05:32\n2023-07-06 14:00:02 stop\n*/\n      this.loaded = false;\n      for (var i=0; i<this.devices.length; i++) {\n        this.tempData.datasets.push({data: []});\n      }\n      var lines = String(raw).split(\"\\n\");\n      for (var l of lines) {\n        var parts = String(l).split(\" \");\n        if (parts.length > 3) {\n          var ix = this.getDeviceIndex(parts[2]) + 1;\n          if (ix !== 0) {\n            var time = Date.parse(parts[0] + \"T\" + parts[1]);\n            var value = (ix * 2.0) + (Number(parts[3]) * 2.0);\n            this.tempData.datasets[ix].data.push({x:time,y:value});\n          }\n        }\n      }\n      console.log(this.tempData);\n      this.loaded = true;\n    },\n    getDeviceIndex(dev) {\n      var ix = -1;\n      for (var i=0; i<this.devices.length; i++) {\n        if(dev === this.devices[i]) {\n          ix = i;\n          break;\n        }\n      }\n      return ix;\n    },\n  },\n  watch: {\n    tcu(newValue) {\n      console.log(\"Variable 'tcu' has changed to \" +  newValue);\n      if (newValue != undefined) {\n        this.day = '';\n        this.getHistDataFiles(newValue);\n        this.getProperties();\n        this.showDay = true;\n      }\n    },\n    day(newValue) {\n      console.log(\"Variable 'day' has changed to \" +  newValue);\n      if (newValue != '') {\n        this.getTempDataFile(newValue);\n//        this.getStateDataFile(newValue);\n        this.showGraph = true;\n      }\n    }\n  },\n  mounted() {\n    this.emitter.on('config', cfg => {\n        console.log(\"Home page received 'config' message: \", cfg);\n        this.config = cfg;\n        this.showDay = false;\n        this.showGraph = false;\n        this.getTcus();\n      }\n    );\n//    this.getTcus();\n    this.showDay = false;\n    this.showGraph = false;\n  },\n}\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}